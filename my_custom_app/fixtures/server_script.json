[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-09-12 15:46:59.857385",
  "module": null,
  "name": "Task Cost Calculation",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Task",
  "script": "# Event: Before Save\n# Doctype: Task\n\nfrappe.log_error(\"Server Script Triggered for Task: \" + doc.name)\n\ntotal_materials_rate = 0\nfor row in doc.custom_materials_required:  # child table rows\n    if row.quantity and row.rate_per_unit:\n        row.total_rate = frappe.utils.flt(row.quantity) * frappe.utils.flt(row.rate_per_unit)\n    else:\n        row.total_rate = 0\n    total_materials_rate += frappe.utils.flt(row.total_rate)\n\n# Update parent custom fields\ndoc.custom_rate_per_unit = total_materials_rate\n\nif doc.custom_quantity:\n    doc.custom_total_rate = frappe.utils.flt(doc.custom_quantity) * frappe.utils.flt(doc.custom_rate_per_unit)\nelse:\n    doc.custom_total_rate = 0\n\nfrappe.log_error(f\"Calculated via Server Script â†’ rate={doc.custom_rate_per_unit}, total={doc.custom_total_rate}\")\n",
  "script_type": "DocType Event"
 }
]